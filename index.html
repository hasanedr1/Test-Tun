<button id="startPipeline">Pipeline starten</button>
<p id="status"></p>

<script>
const statusEl = document.getElementById("status");

document.getElementById("startPipeline").onclick = async () => {
  statusEl.innerText = "Pipeline wird gestartet...";

  const startRes = await fetch(
    "https://azure-pipeline-trigger.vercel.app/api/start-pipeline",
    { method: "POST" }
  );

  const { runId } = await startRes.json();

  statusEl.innerText = "Tests laufen...";

  const interval = setInterval(async () => {
    const res = await fetch(
      `https://azure-pipeline-trigger.vercel.app/api/pipeline-status?runId=${runId}`
    );

    const data = await res.json();

    if (data.state === "completed") {
      clearInterval(interval);

      if (data.result === "succeeded") {
        statusEl.innerText = "✅ Test PASSED";
      } else {
        statusEl.innerText = "❌ Test FAILED";
      }
    }
  }, 5000);
};
</script>
