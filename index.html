<button id="startPipeline">Pipeline starten</button>
<p id="status"></p>

<script>
const statusEl = document.getElementById("status");

document.getElementById("startPipeline").onclick = async () => {
  statusEl.innerText = "Pipeline wird gestartet...";

  try {
    const startRes = await fetch("/api/start-pipeline", { method: "POST" });
    const json = await startRes.json();

    if (!startRes.ok) {
      statusEl.innerText = "Fehler beim Starten: " + (json.error || startRes.statusText);
      return;
    }

    const { runId } = json;
    statusEl.innerText = "Pipeline gestartet, runId: " + runId;

    // Status abfragen
    const interval = setInterval(async () => {
      try {
        const res = await fetch(`/api/pipeline-status?runId=${runId}`);
        const data = await res.json();
        statusEl.innerText = JSON.stringify(data); // Einfach alles anzeigen
        if (data.state?.toLowerCase() === "completed") clearInterval(interval);
      } catch (err) {
        statusEl.innerText = "Fehler beim Abrufen des Status: " + err.message;
        clearInterval(interval);
      }
    }, 5000);

  } catch (err) {
    statusEl.innerText = "Fehler beim Starten: " + err.message;
  }
};
</script>
